<?xml version="1.0" encoding="UTF-8"?>
<project name="BPO2WithSonarAnt" default="sonarTest" xmlns:sonar="antlib:org.sonar.ant" basedir=".">

	<!-- Define the SonarQube global properties (the most usual way is to pass these properties via the command line) -->
	<property name="sonar.host.url" value="http://localhost:9000" />
	<property name="sonar.login" value="admin" />
	<property name="sonar.password" value="admin" />

	<!-- Define the SonarQube project properties -->
	<property name="sonar.projectKey" value="BPO2WithSonarAntKey" />
	<property name="sonar.projectName" value="Test SonarQube Scanner for Ant" />
	<property name="sonar.projectVersion" value="1.0" />
	<property name="sonar.sources" value="src" />
	<property name="sonar.java.binaries" value="bin" />
	<property name="sonar.java.libraries" value="lib/*.jar" />
	<property name="sonar.sourceEncoding" value="UTF-8" />
	<property name="sonar.java.source" value="8" />
	<property name="sonar.language" value="java" />

	<!-- ========= Define the main properties of this project ========= -->
	<property name="src.dir" location="src" />
	<property name="bin.dir" location="bin" />
	<property name="lib.dir" location="lib" />
	<path id="classpath">
        <fileset dir="${lib.dir}">
            <include name="**/*.jar" />
        </fileset>
    </path>
	<!-- ========= Define "regular" targets: clean, init, compile, ... ========= -->

		<!-- Deletes the existing build directory -->
	<target name="clean" description="remove intermediate files">
		<delete dir="${bin.dir}" /> 
	</target>

	<target name="init">
		<!-- Create the time stamp -->
		<tstamp />
		<echo message="Nous sommes le ${TODAY}" />
		<echo message="DSTAMP = ${DSTAMP}" />
		<echo message="TSTAMP = ${TSTAMP}" />
		
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${bin.dir}" />
	</target>

	<target name="compile" depends="clean, init" description="compile the Java source code to class files">
		<javac includeantruntime="false" srcdir="${src.dir}" destdir="${bin.dir}" classpathref="classpath" />
	</target>

	<!-- Define SonarScanner for Ant Target -->
	<target name="sonarTest" depends="compile" >
		<taskdef uri="antlib:org.sonar.ant" resource="org/sonar/ant/antlib.xml">
    	    <!-- Update the following line, or put the "sonarqube-ant-task-*.jar" file in your "$HOME/.ant/lib" folder -->
   	    	<classpath path="sonarqube-ant-task-2.5.jar" />
   	    </taskdef> 
		
		<!-- Execute SonarScanner for Ant Analysis -->
    	<sonar:sonar />
	</target>

</project>